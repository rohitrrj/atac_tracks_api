# ATAC-seq Tracks API
![Docker](https://img.shields.io/badge/docker-ready-blue.svg)
![R](https://img.shields.io/badge/R-API-blue.svg)
![License](https://img.shields.io/badge/license-MIT-blue.svg)

A RESTful API service for retrieving and visualizing ATAC-seq genomic tracks data. Built with R and Docker for scalable deployment and integration with genome browsers.

## Table of Contents
- [Overview](#overview)
- [Features](#features)
- [Quick Start](#quick-start)
- [Installation](#installation)
- [API Documentation](#api-documentation)
- [Docker Deployment](#docker-deployment)
- [Configuration](#configuration)
- [Contributing](#contributing)

## Overview
This API provides programmatic access to ATAC-seq track data, enabling seamless integration with genome browsers and visualization tools. It processes and serves data generated by the [ATACseq_Pipeline](../ATACseq_Pipeline).

## Features
- RESTful API endpoints for track data access
- Query by genomic coordinates
- Multiple data format support (bigWig, bedGraph)
- Gene ID lookup functionality
- Scalable Docker deployment
- Comprehensive error handling
- Cross-origin resource sharing (CORS)
- Request rate limiting

## Quick Start

Using Docker:
```bash
docker pull yourusername/atac-tracks-api
docker run -p 8000:8000 yourusername/atac-tracks-api
```

Access the API at: http://localhost:8000

## Installation

### Local Installation
1. Clone the repository:
```bash
git clone https://github.com/yourusername/atac_tracks_api.git
cd atac_tracks_api
```

2. Install R dependencies:
```R
install.packages(c(
  "plumber",
  "GenomicRanges",
  "rtracklayer",
  "data.table"
))
```

3. Run the API:
```bash
Rscript server.R
```

## API Documentation

### Endpoints

#### GET /tracks/{sample}/{chrom}/{start}/{end}
Retrieve track data for a specific genomic region.

Parameters:
- sample: Sample identifier
- chrom: Chromosome number/name
- start: Start position
- end: End position

Response:
```json
{
  "track_data": [
    {
      "position": 1000,
      "score": 5.2
    },
    ...
  ]
}
```

#### GET /genes/{gene_id}
Get genomic coordinates for a gene.

Parameters:
- gene_id: Gene identifier

Response:
```json
{
  "gene_info": {
    "chrom": "chr1",
    "start": 1000,
    "end": 5000,
    "strand": "+"
  }
}
```

### Error Responses
```json
{
  "error": "Error message",
  "status": 400
}
```

## Docker Deployment

### Dockerfile
```dockerfile
FROM rocker/r-ver:4.1.0

# Install system dependencies
RUN apt-get update && apt-get install -y \
    libcurl4-gnutls-dev \
    libssl-dev \
    libxml2-dev

# Install R packages
RUN R -e 'install.packages(c("plumber", "GenomicRanges", "rtracklayer", "data.table"))'

# Copy application files
COPY . /app
WORKDIR /app

# Expose port
EXPOSE 8000

# Start API server
CMD ["Rscript", "server.R"]
```

### Building and Running
```bash
# Build image
docker build -t atac-tracks-api .

# Run container
docker run -d \
  -p 8000:8000 \
  -v /path/to/data:/app/data \
  --name atac-tracks-api \
  atac-tracks-api
```

## Configuration

### Server Configuration
Edit `server.R`:
```R
# API configuration
options(
  plumber.port = 8000,
  plumber.host = "0.0.0.0"
)

# Data paths
TRACK_DATA_DIR = "data/tracks"
GENE_INFO_FILE = "data/gene_info.txt"
```

### Rate Limiting
```R
# Configure rate limits
pr$filter("rate-limit", function(req, res) {
  rate_limit(
    rate = 100,  # requests
    per = 60     # seconds
  )
})
```

## Data Requirements

### Track Files
- bigWig or bedGraph format
- Chromosome-specific files
- Consistent naming convention

### Gene Information
Tab-delimited file with columns:
- gene_id
- chrom
- start
- end
- strand

## Error Handling

The API implements comprehensive error handling for:
- Invalid genomic coordinates
- Missing data files
- Rate limit exceedance
- Malformed requests
- Server errors

## Performance Optimization

1. **Data Access**
   - File caching
   - Query optimization
   - Response compression

2. **Resource Management**
   - Connection pooling
   - Memory optimization
   - Request queuing

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

### Development Guidelines
- Follow R code style guidelines
- Add unit tests
- Update API documentation
- Test Docker deployment

## License
This project is licensed under the MIT License - see the LICENSE file for details.

## Citation
If you use this API in your research, please cite:
```
Author et al. (Year). ATAC-seq Tracks API: A RESTful service for ATAC-seq data retrieval.
Repository: https://github.com/yourusername/atac_tracks_api
```

## Related Projects
- [ATACseq_Pipeline](../ATACseq_Pipeline)
- [goronzy_lab](../goronzy_lab)
- [macrophage_atac](../macrophage_atac)

## Acknowledgments
- Built with R Plumber
- Data processing: ATACseq_Pipeline
- Supporting institutions and funding
